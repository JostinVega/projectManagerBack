container_commands:
  01_create_efs_dir:
    command: "sudo mkdir -p /mnt/efs"
    leader_only: true
  02_mount_efs:
    command: |
      sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport fs-01d8894a02f572a94.efs.us-east-1.amazonaws.com:/ /mnt/efs
      echo "fs-01d8894a02f572a94.efs.us-east-1.amazonaws.com:/ /mnt/efs nfs4 nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport 0 0" | sudo tee -a /etc/fstab
    leader_only: true
option_settings:
  aws:elasticbeanstalk:application:environment:
    EFS_MOUNT_POINT: "/mnt/efs"